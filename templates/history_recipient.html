<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Claim History - Prasadam</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/history_donation.css') }}">
</head>
<body>
<header>
    <div class="logo">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
        <h1>Prasadam - Claim History</h1>
    </div>
    <div class="profile">
        <a href="{{ url_for('ngo_dashboard') }}" class="btn back-link">Dashboard</a>
        <div class="profile-dropdown">
            <img src="{{ profile_picture or 'https://avatar.iran.liara.run/public/3' }}" alt="Profile Picture" class="profile-pic" onclick="toggleDropdown(event)">
            <div class="dropdown-content" id="profileDropdown">
                <a href="{{ url_for('profile') }}">Profile</a>
                <a href="{{ url_for('manage_affiliations') }}">Manage Affiliations</a>
                <a href="{{ url_for('claim_history') }}" class="active">Claim History</a>
                <hr>
                <a href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </div>
</header>

<main class="history-container">
    <div class="history-stats">
        <div class="stat-card secondary-section">
            <h3>{{ stats.total_claims }}</h3>
            <p>Total Claims</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.active_claims }}</h3>
            <p>Active Claims</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.completed_claims }}</h3>
            <p>Completed Claims</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.total_servings }}</h3>
            <p>People Served</p>
        </div>
    </div>

    <div class="history-tabs">
        <button class="tab-button active" onclick="showTab('active')">Active Claims</button>
        <button class="tab-button" onclick="showTab('completed')">Completed Claims</button>
    </div>

    <!-- Active Claims Section -->
    <div id="active-claims" class="tab-content primary-section" style="display: block;">
        <div class="donation-cards">
            {% if active_claims %}
                {% for claim in active_claims %}
                    <div class="donation-card secondary-section" onclick="window.location.href='{{ url_for('recipient_request_details', request_id=claim.id) }}'">
                        <h4>Food Donation</h4>
                        <small class="form-small">Donation ID: {{ claim.id }}</small><br>
                        <span class="donation-status status-{{ claim.status.lower() }}">{{ claim.status }}</span>
                        <div class="donation-info">
                            <p><i>üë®‚Äçüç≥</i> From: {{ claim.donor_name }}</p>
                            <p><i>üç±</i> {{ claim.food_type }}</p>
                            <p><i>üë•</i> Serves {{ claim.quantity }} people</p>
                            <p><i>üìç</i> {{ claim.address }}</p>
                            {% if claim.status == 'Assigned' %}
                                <p><i>üöó</i> Driver: {{ claim.driver_name }}</p>
                            {% endif %}
                            <p><i>üïí</i> {{ claim.pickup_time }}</p>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.created_at }}</div>
                                <div>Listing created by donor</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.claimed_at }}</div>
                                <div>Claimed by you</div>
                            </div>
                            {% if claim.status == 'Assigned' %}
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.assigned_at }}</div>
                                <div>Driver assigned: {{ claim.driver_name }}</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-donations secondary-section">
                    <h3>No active claims</h3>
                    <p>You don't have any active claims at the moment.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Completed Claims Section -->
    <div id="completed-claims" class="tab-content primary-section" style="display: none;">
        <div class="donation-cards">
            {% if completed_claims %}
                {% for claim in completed_claims %}
                    <div class="donation-card secondary-section">
                        <h4>Food Donation</h4>
                        <small class="form-small">Donation ID: {{ claim.id }}</small><br>
                        <span class="donation-status status-collected">Completed</span>
                        <div class="donation-info">
                            <p><i>üë®‚Äçüç≥</i> From: {{ claim.donor_name }}</p>
                            <p><i>üç±</i> {{ claim.food_type }}</p>
                            <p><i>üë•</i> Served {{ claim.quantity }} people</p>
                            <p><i>üìç</i> {{ claim.address }}</p>
                            <p><i>üöó</i> Collected by: {{ claim.driver_name }}</p>
                            <p><i>üìÖ</i> {{ claim.collected_at }}</p>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.created_at }}</div>
                                <div>Listing created by donor</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.claimed_at }}</div>
                                <div>Claimed by you</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.assigned_at }}</div>
                                <div>Driver assigned: {{ claim.driver_name }}</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ claim.collected_at }}</div>
                                <div>Food collected successfully</div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-donations secondary-section">
                    <h3>No completed claims</h3>
                    <p>You haven't completed any claims yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
</main>

<script>
function toggleDropdown(event) {
    event.stopPropagation();
    document.getElementById('profileDropdown').classList.toggle('show');
}

window.onclick = function(event) {
    if (!event.target.matches('.profile-pic')) {
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
        }
    }
}

function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Show selected tab content
    document.getElementById(tabName + '-claims').style.display = 'block';

    // Update tab button states
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    event.target.classList.add('active');
}
</script>
</body>
</html>
