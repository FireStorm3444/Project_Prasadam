<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pickup History - Prasadam</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='history_pickup.css') }}">
</head>
<body>
<header>
    <div class="logo">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
        <h1>Prasadam - Pickup History</h1>
    </div>
    <div class="profile">
        <a href="{{ url_for('driver_dashboard') }}" class="btn back-link">Dashboard</a>
        <div class="profile-dropdown">
            <img src="{{ profile_picture or 'https://avatar.iran.liara.run/public/3' }}" alt="Profile Picture" class="profile-pic" onclick="toggleDropdown(event)">
            <div class="dropdown-content" id="profileDropdown">
                <a href="{{ url_for('profile') }}">Profile</a>
                <a href="{{ url_for('pickup_history') }}" class="active">Pickup History</a>
                <hr>
                <a href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </div>
</header>

<main class="history-container">
    <div class="history-stats">
        <div class="stat-card secondary-section">
            <h3>{{ stats.total_pickups }}</h3>
            <p>Total Pickups</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.active_pickups }}</h3>
            <p>Active Pickups</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.completed_pickups }}</h3>
            <p>Completed Pickups</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.total_servings }}</h3>
            <p>People Served</p>
        </div>
    </div>

    <div class="history-tabs">
        <button class="tab-button active" onclick="showTab('active')">Active Pickups</button>
        <button class="tab-button" onclick="showTab('completed')">Completed Pickups</button>
    </div>

    <!-- Active Pickups Section -->
    <div id="active-pickups" class="tab-content primary-section" style="display: block;">
        <div class="pickup-cards">
            {% if active_pickups %}
                {% for pickup in active_pickups %}
                    <div class="pickup-card secondary-section" onclick="window.location.href='{{ url_for('pickup_details', request_id=pickup.id) }}'">
                        <h4>{{ pickup.donor_name }}</h4>
                        <span class="pickup-status status-active">Active</span>
                        <div class="pickup-info">
                            <p><i>üìç</i> {{ pickup.address }}</p>
                            <p><i>üïí</i> {{ pickup.pickup_time }}</p>
                            <p><i>üç±</i> {{ pickup.food_type }}</p>
                            <p><i>üë•</i> Serves {{ pickup.quantity }} people</p>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">{{ pickup.assigned_at }}</div>
                                <div>Assigned to you</div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-pickups secondary-section">
                    <h3>No active pickups</h3>
                    <p>You don't have any active pickups at the moment.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Completed Pickups Section -->
    <div id="completed-pickups" class="tab-content primary-section" style="display: none;">
        <div class="pickup-cards">
            {% if completed_pickups %}
                {% for pickup in completed_pickups %}
                    <div class="pickup-card secondary-section">
                        <h4>{{ pickup.donor_name }}</h4>
                        <span class="pickup-status status-collected">Completed</span>
                        <div class="pickup-info">
                            <p><i>üìç</i> {{ pickup.address }}</p>
                            <p><i>üç±</i> {{ pickup.food_type }}</p>
                            <p><i>üë•</i> Served {{ pickup.quantity }} people</p>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">{{ pickup.assigned_at }}</div>
                                <div>Assigned to you</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ pickup.collected_at }}</div>
                                <div>Pickup completed</div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-pickups secondary-section">
                    <h3>No completed pickups</h3>
                    <p>You haven't completed any pickups yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
</main>

<script>
function toggleDropdown(event) {
    event.stopPropagation();
    document.getElementById('profileDropdown').classList.toggle('show');
}

window.onclick = function(event) {
    if (!event.target.matches('.profile-pic')) {
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
        }
    }
}

function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Show selected tab content
    document.getElementById(tabName + '-pickups').style.display = 'block';

    // Update tab button states
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    event.target.classList.add('active');
}
</script>
</body>
</html>
