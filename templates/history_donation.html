<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Donation History - Prasadam</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/history_donation.css') }}">
</head>
<body>
<header>
    <div class="logo">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
        <h1>Prasadam - Donation History</h1>
    </div>
    <div class="profile">
        <a href="{{ url_for('home') }}" class="btn back-link">Dashboard</a>
        <div class="profile-dropdown">
            <img src="{{ profile_picture }}" alt="Profile Picture" class="profile-pic" onclick="toggleDropdown(event)">
            <div class="dropdown-content" id="profileDropdown">
                <a href="{{ url_for('profile') }}">Profile</a>
                <a href="{{ url_for('donation_history') }}" class="active">Donation History</a>
                <hr>
                <a href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </div>
</header>

<main class="history-container">
    <div class="history-stats">
        <div class="stat-card secondary-section">
            <h3>{{ stats.total_donations }}</h3>
            <p>Total Donations</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.active_donations }}</h3>
            <p>Active Listings</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.completed_donations }}</h3>
            <p>Completed Donations</p>
        </div>
        <div class="stat-card secondary-section">
            <h3>{{ stats.total_servings }}</h3>
            <p>People Served</p>
        </div>
    </div>

    <div class="history-tabs">
        <button class="tab-button active" onclick="showTab('active')">Active Donations</button>
        <button class="tab-button" onclick="showTab('completed')">Completed Donations</button>
    </div>

    <!-- Active Donations Section -->
    <div id="active-donations" class="tab-content primary-section" style="display: block;">
        <div class="donation-cards">
            {% if active_donations %}
                {% for donation in active_donations %}
                    <div class="donation-card secondary-section" onclick="window.location.href='{{ url_for('donor_request_details', request_id=donation.id) }}'">
                        <h4>Food Donation</h4>
                        <small class="form-small">Donation ID: {{ donation.id }}</small><br>
                        <span class="donation-status status-{{ donation.status.lower() }}">{{ donation.status }}</span>
                        <div class="donation-info">
                            <p><i>üç±</i> {{ donation.food_type }}</p>
                            <p><i>üë•</i> Serves {{ donation.quantity }} people</p>
                            <p><i>üìç</i> {{ donation.address }}</p>
                            <p><i>üïí</i> {{ donation.pickup_time }}</p>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.created_at }}</div>
                                <div>Listing created</div>
                            </div>
                            {% if donation.status != 'Pending' %}
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.claimed_at }}</div>
                                <div>Claimed by {{ donation.recipient_name }}</div>
                            </div>
                            {% endif %}
                            {% if donation.status == 'Assigned' %}
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.assigned_at }}</div>
                                <div>Driver assigned: {{ donation.driver_name }}</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-donations secondary-section">
                    <h3>No active donations</h3>
                    <p>You don't have any active donations at the moment.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Completed Donations Section -->
    <div id="completed-donations" class="tab-content primary-section" style="display: none;">
        <div class="donation-cards">
            {% if completed_donations %}
                {% for donation in completed_donations %}
                    <div class="donation-card secondary-section" onclick="window.location.href='{{ url_for('donor_request_details', request_id=donation.id) }}'">
                        <h4>Food Donation</h4>
                        <small class="form-small">Donation ID: {{ donation.id }}</small><br>
                        <span class="donation-status status-collected">Completed</span>
                        <div class="donation-info">
                            <p><i>üç±</i> {{ donation.food_type }}</p>
                            <p><i>üë•</i> Served {{ donation.quantity }} people</p>
                            <p><i>üìç</i> {{ donation.address }}</p>
                            <p><i>üìÖ</i> {{ donation.completed_at }}</p>
                        </div>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.created_at }}</div>
                                <div>Listing created</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.claimed_at }}</div>
                                <div>Claimed by {{ donation.recipient_name }}</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.assigned_at }}</div>
                                <div>Driver assigned: {{ donation.driver_name }}</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">{{ donation.completed_at }}</div>
                                <div>Food collected successfully</div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-donations secondary-section">
                    <h3>No completed donations</h3>
                    <p>You haven't completed any donations yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
</main>

<script>
function toggleDropdown(event) {
    event.stopPropagation();
    document.getElementById('profileDropdown').classList.toggle('show');
}

window.onclick = function(event) {
    if (!event.target.matches('.profile-pic')) {
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
        }
    }
}

function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Show selected tab content
    document.getElementById(tabName + '-donations').style.display = 'block';

    // Update tab button states
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    event.target.classList.add('active');
}
</script>
</body>
</html>
